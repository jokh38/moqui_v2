<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Moqui: mqi::roi_t Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Moqui
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('classmqi_1_1roi__t.html','','classmqi_1_1roi__t-members'); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">mqi::roi_t Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Manages the mapping from a global transport grid to a sparse Region of Interest (ROI) for scoring.  
 <a href="#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-methods" class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a83fb1a8df1a5891804cc5e73d7d8c894" id="r_a83fb1a8df1a5891804cc5e73d7d8c894"><td class="memItemLeft" align="right" valign="top"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a83fb1a8df1a5891804cc5e73d7d8c894">roi_t</a> (<a class="el" href="namespacemqi.html#a8e583bf8677c9d3aaecfdced26932148">roi_mapping_t</a> m, uint32_t n, int32_t l=0, uint32_t *s=nullptr, uint32_t *t=nullptr, uint32_t *a=nullptr)</td></tr>
<tr class="memdesc:a83fb1a8df1a5891804cc5e73d7d8c894"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructs an <a class="el" href="classmqi_1_1roi__t.html" title="Manages the mapping from a global transport grid to a sparse Region of Interest (ROI) for scoring.">roi_t</a> object.  <br /></td></tr>
<tr class="memitem:affd7f29cf86969787c38a73c1f48c557" id="r_affd7f29cf86969787c38a73c1f48c557"><td class="memItemLeft" align="right" valign="top"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#affd7f29cf86969787c38a73c1f48c557">idx</a> (const uint32_t &amp;v) const</td></tr>
<tr class="memdesc:affd7f29cf86969787c38a73c1f48c557"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determines if a transport index <span class="tt">v</span> is inside the ROI and gets its mapped index.  <br /></td></tr>
<tr class="memitem:a9764dd2d41712af6b7e16588dcc953a1" id="r_a9764dd2d41712af6b7e16588dcc953a1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9764dd2d41712af6b7e16588dcc953a1">get_mask_idx</a> (const uint32_t &amp;v) const</td></tr>
<tr class="memdesc:a9764dd2d41712af6b7e16588dcc953a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the final index within the flattened ROI data array for a given transport index.  <br /></td></tr>
<tr class="memitem:a41a098bbf69a543073f92d48c60ef694" id="r_a41a098bbf69a543073f92d48c60ef694"><td class="memItemLeft" align="right" valign="top"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a41a098bbf69a543073f92d48c60ef694">get_mask_size</a> () const</td></tr>
<tr class="memdesc:a41a098bbf69a543073f92d48c60ef694"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the total number of voxels in the ROI.  <br /></td></tr>
<tr class="memitem:a9a212c570127c7bfd095ea5c262e5be4" id="r_a9a212c570127c7bfd095ea5c262e5be4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9a212c570127c7bfd095ea5c262e5be4">get_contour_idx</a> (const uint32_t &amp;v) const</td></tr>
<tr class="memdesc:a9a212c570127c7bfd095ea5c262e5be4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the ROI mask index for a transport index using the CONTOUR (run-length-encoded) method.  <br /></td></tr>
<tr class="memitem:a1ec54fc184d0bffe3cb232f6c25e7598" id="r_a1ec54fc184d0bffe3cb232f6c25e7598"><td class="memItemLeft" align="right" valign="top"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1ec54fc184d0bffe3cb232f6c25e7598">idx_contour</a> (const uint32_t &amp;v) const</td></tr>
<tr class="memdesc:a1ec54fc184d0bffe3cb232f6c25e7598"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if a transport index is within any contour segment.  <br /></td></tr>
<tr class="memitem:a032dd49ae2788d2abcbd6d8969db742f" id="r_a032dd49ae2788d2abcbd6d8969db742f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a032dd49ae2788d2abcbd6d8969db742f">idx_indirect</a> (const uint32_t &amp;v) const</td></tr>
<tr class="memdesc:a032dd49ae2788d2abcbd6d8969db742f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the mapped index for the INDIRECT method.  <br /></td></tr>
<tr class="memitem:a2aeb34103c1b74ae019ea7215991c81b" id="r_a2aeb34103c1b74ae019ea7215991c81b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a> int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2aeb34103c1b74ae019ea7215991c81b">lower_bound_cpp</a> (const int32_t &amp;value) const</td></tr>
<tr class="memdesc:a2aeb34103c1b74ae019ea7215991c81b"><td class="mdescLeft">&#160;</td><td class="mdescRight">A custom binary search implementation to find the lower bound of a value in the <span class="tt">start_</span> array.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-attribs" class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a27f1ec8039fb8db4c54e79da6032b48b" id="r_a27f1ec8039fb8db4c54e79da6032b48b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacemqi.html#a8e583bf8677c9d3aaecfdced26932148">roi_mapping_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a27f1ec8039fb8db4c54e79da6032b48b">method_</a></td></tr>
<tr class="memdesc:a27f1ec8039fb8db4c54e79da6032b48b"><td class="mdescLeft">&#160;</td><td class="mdescRight">The mapping method to use (DIRECT, INDIRECT, or CONTOUR).  <br /></td></tr>
<tr class="memitem:a267ca456284546f73fb9fcd00a7d874d" id="r_a267ca456284546f73fb9fcd00a7d874d"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a267ca456284546f73fb9fcd00a7d874d">original_length_</a></td></tr>
<tr class="memdesc:a267ca456284546f73fb9fcd00a7d874d"><td class="mdescLeft">&#160;</td><td class="mdescRight">The total number of voxels in the original, full transport grid (e.g., 512*512*200).  <br /></td></tr>
<tr class="memitem:ac717667bcbeb499c5ad5c51a8280e775" id="r_ac717667bcbeb499c5ad5c51a8280e775"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac717667bcbeb499c5ad5c51a8280e775">length_</a></td></tr>
<tr class="memdesc:ac717667bcbeb499c5ad5c51a8280e775"><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of elements in the mapping arrays (<span class="tt">start_</span>, <span class="tt">stride_</span>, <span class="tt">acc_stride_</span>). For INDIRECT, this is the size of the lookup table. For CONTOUR, it's the number of "runs".  <br /></td></tr>
<tr class="memitem:a85f363d41670774f21b5c341950ce0ed" id="r_a85f363d41670774f21b5c341950ce0ed"><td class="memItemLeft" align="right" valign="top">uint32_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a85f363d41670774f21b5c341950ce0ed">start_</a></td></tr>
<tr class="memdesc:a85f363d41670774f21b5c341950ce0ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">For INDIRECT: A lookup table where <span class="tt">start_[transport_idx] = roi_idx</span>. For CONTOUR: The transport index where each run of ROI voxels begins.  <br /></td></tr>
<tr class="memitem:ac29a348e0e4fe7db0561290e638031a0" id="r_ac29a348e0e4fe7db0561290e638031a0"><td class="memItemLeft" align="right" valign="top">uint32_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac29a348e0e4fe7db0561290e638031a0">stride_</a></td></tr>
<tr class="memdesc:ac29a348e0e4fe7db0561290e638031a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">For CONTOUR only: The length (number of consecutive voxels) of each run.  <br /></td></tr>
<tr class="memitem:aac34fc25faebb20a51b513ba327d5861" id="r_aac34fc25faebb20a51b513ba327d5861"><td class="memItemLeft" align="right" valign="top">uint32_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aac34fc25faebb20a51b513ba327d5861">acc_stride_</a></td></tr>
<tr class="memdesc:aac34fc25faebb20a51b513ba327d5861"><td class="mdescLeft">&#160;</td><td class="mdescRight">For CONTOUR only: The accumulated length of all preceding runs. <span class="tt">acc_stride_[i]</span> gives the starting index in the ROI array for the i-th run.  <br /></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Manages the mapping from a global transport grid to a sparse Region of Interest (ROI) for scoring. </p>
<p>This class is a key optimization for Monte Carlo simulations. The "transport grid" can be very large (e.g., a 512x512x200 CT scan), but we often only care about the dose in a smaller, irregularly shaped "scoring grid" or ROI (e.g., a tumor). This class provides the logic to quickly determine if a given voxel from the large grid is inside the ROI, and if so, what its index is in the smaller, densely packed ROI data array.</p>
<p>This is crucial for performance on GPUs, where memory is limited and memory access patterns are critical. Instead of allocating a huge array for the full grid, we only allocate a smaller one for the ROI and use this class to map to it.</p>
<p>For a Python developer, think of this as managing a sparse matrix format. Instead of a giant NumPy array full of zeros, you store only the non-zero values and their indices.</p>
<p>The class does not own the mapping arrays (<span class="tt">start_</span>, <span class="tt">stride_</span>, etc.). It only holds pointers to them, assuming they are allocated and managed elsewhere (e.g., on the GPU). </p>

<p class="definition">Definition at line <a class="el" href="mqi__roi_8hpp_source.html#l00049">49</a> of file <a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>.</p>
</div><a name="doc-constructors" id="doc-constructors"></a><h2 id="header-doc-constructors" class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a83fb1a8df1a5891804cc5e73d7d8c894" name="a83fb1a8df1a5891804cc5e73d7d8c894"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83fb1a8df1a5891804cc5e73d7d8c894">&#9670;&#160;</a></span>roi_t()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a> mqi::roi_t::roi_t </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacemqi.html#a8e583bf8677c9d3aaecfdced26932148">roi_mapping_t</a></td>          <td class="paramname"><span class="paramname"><em>m</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>n</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t</td>          <td class="paramname"><span class="paramname"><em>l</em></span><span class="paramdefsep"> = </span><span class="paramdefval">0</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *</td>          <td class="paramname"><span class="paramname"><em>s</em></span><span class="paramdefsep"> = </span><span class="paramdefval">nullptr</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *</td>          <td class="paramname"><span class="paramname"><em>t</em></span><span class="paramdefsep"> = </span><span class="paramdefval">nullptr</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *</td>          <td class="paramname"><span class="paramname"><em>a</em></span><span class="paramdefsep"> = </span><span class="paramdefval">nullptr</span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Constructs an <a class="el" href="classmqi_1_1roi__t.html" title="Manages the mapping from a global transport grid to a sparse Region of Interest (ROI) for scoring.">roi_t</a> object. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td>The mapping method. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>The total size of the original transport grid. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">l</td><td>The length of the mapping arrays. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">s</td><td>Pointer to the start/indirect-index array. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">t</td><td>Pointer to the stride array (for CONTOUR mapping). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">a</td><td>Pointer to the accumulated stride array (for CONTOUR mapping). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mqi__roi_8hpp_source.html#l00072">72</a> of file <a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>.</p>

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Member Function Documentation</h2>
<a id="a9a212c570127c7bfd095ea5c262e5be4" name="a9a212c570127c7bfd095ea5c262e5be4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a212c570127c7bfd095ea5c262e5be4">&#9670;&#160;</a></span>get_contour_idx()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a> int32_t mqi::roi_t::get_contour_idx </td>
          <td>(</td>
          <td class="paramtype">const uint32_t &amp;</td>          <td class="paramname"><span class="paramname"><em>v</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculates the ROI mask index for a transport index using the CONTOUR (run-length-encoded) method. </p>
<p>Example: Imagine an ROI consists of voxels 10-14 (5 voxels) and 25-26 (2 voxels). The mapping arrays would be:</p><ul>
<li><span class="tt">start_</span>: [10, 25]</li>
<li><span class="tt">stride_</span>: [5, 2]</li>
<li><span class="tt">acc_stride_</span>: [5, 7] (i.e., [5, 5+2])</li>
</ul>
<p>If we query for transport index <span class="tt">v = 13</span>:</p><ol type="1">
<li><span class="tt">lower_bound_cpp(13)</span> finds the index of the first element in <span class="tt">start_</span> that is &gt; 13. This is index 1 (value 25).</li>
<li>We check the preceding run by using <span class="tt">c = 1 - 1 = 0</span>.</li>
<li>We find the distance from the start of this run: <span class="tt">distance = v - start_[c] = 13 - 10 = 3</span>.</li>
<li>We check if this distance is within the run's length: <span class="tt">distance (3) &lt; stride_[c] (5)</span>. It is.</li>
<li>The base index for this run <span class="tt">c=0</span> is 0 (since <span class="tt">c &lt; 1</span>). The final ROI index is <span class="tt">0 + distance = 3</span>.</li>
</ol>
<p>If we query for <span class="tt">v = 25</span>:</p><ol type="1">
<li><span class="tt">lower_bound_cpp(25)</span> finds the index of the first element &gt; 25. Let's assume it returns 2 (end of array).</li>
<li>We check the preceding run: <span class="tt">c = 2 - 1 = 1</span>.</li>
<li><span class="tt">distance = v - start_[c] = 25 - 25 = 0</span>.</li>
<li><span class="tt">distance (0) &lt; stride_[c] (2)</span>. It is.</li>
<li>The base index for run <span class="tt">c=1</span> is <span class="tt">acc_stride_[c-1] = acc_stride_[0] = 5</span>.</li>
<li>The final ROI index is <span class="tt">5 + distance = 5</span>.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>The transport grid index. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The final ROI index if <span class="tt">v</span> is within a contour segment, otherwise -1. </dd></dl>

<p class="definition">Definition at line <a class="el" href="mqi__roi_8hpp_source.html#l00171">171</a> of file <a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classmqi_1_1roi__t_a9a212c570127c7bfd095ea5c262e5be4_cgraph.png" border="0" usemap="#aclassmqi_1_1roi__t_a9a212c570127c7bfd095ea5c262e5be4_cgraph" loading="lazy" alt=""/></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classmqi_1_1roi__t_a9a212c570127c7bfd095ea5c262e5be4_icgraph.png" border="0" usemap="#aclassmqi_1_1roi__t_a9a212c570127c7bfd095ea5c262e5be4_icgraph" loading="lazy" alt=""/></div>
</div>

</div>
</div>
<a id="a9764dd2d41712af6b7e16588dcc953a1" name="a9764dd2d41712af6b7e16588dcc953a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9764dd2d41712af6b7e16588dcc953a1">&#9670;&#160;</a></span>get_mask_idx()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a> int32_t mqi::roi_t::get_mask_idx </td>
          <td>(</td>
          <td class="paramtype">const uint32_t &amp;</td>          <td class="paramname"><span class="paramname"><em>v</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the final index within the flattened ROI data array for a given transport index. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>The transport grid index. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The corresponding index in the ROI's own data array (from 0 to <span class="tt"><a class="el" href="#a41a098bbf69a543073f92d48c60ef694" title="Gets the total number of voxels in the ROI.">get_mask_size()</a>-1</span>), or -1 if outside the ROI. </dd></dl>

<p class="definition">Definition at line <a class="el" href="mqi__roi_8hpp_source.html#l00111">111</a> of file <a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classmqi_1_1roi__t_a9764dd2d41712af6b7e16588dcc953a1_cgraph.png" border="0" usemap="#aclassmqi_1_1roi__t_a9764dd2d41712af6b7e16588dcc953a1_cgraph" loading="lazy" alt=""/></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classmqi_1_1roi__t_a9764dd2d41712af6b7e16588dcc953a1_icgraph.png" border="0" usemap="#aclassmqi_1_1roi__t_a9764dd2d41712af6b7e16588dcc953a1_icgraph" loading="lazy" alt=""/></div>
</div>

</div>
</div>
<a id="a41a098bbf69a543073f92d48c60ef694" name="a41a098bbf69a543073f92d48c60ef694"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41a098bbf69a543073f92d48c60ef694">&#9670;&#160;</a></span>get_mask_size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a> int32_t mqi::roi_t::get_mask_size </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the total number of voxels in the ROI. </p>
<dl class="section return"><dt>Returns</dt><dd>The size of the ROI data array. </dd></dl>

<p class="definition">Definition at line <a class="el" href="mqi__roi_8hpp_source.html#l00128">128</a> of file <a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classmqi_1_1roi__t_a41a098bbf69a543073f92d48c60ef694_icgraph.png" border="0" usemap="#aclassmqi_1_1roi__t_a41a098bbf69a543073f92d48c60ef694_icgraph" loading="lazy" alt=""/></div>
</div>

</div>
</div>
<a id="affd7f29cf86969787c38a73c1f48c557" name="affd7f29cf86969787c38a73c1f48c557"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affd7f29cf86969787c38a73c1f48c557">&#9670;&#160;</a></span>idx()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a> int32_t mqi::roi_t::idx </td>
          <td>(</td>
          <td class="paramtype">const uint32_t &amp;</td>          <td class="paramname"><span class="paramname"><em>v</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Determines if a transport index <span class="tt">v</span> is inside the ROI and gets its mapped index. </p>
<p>This is a general-purpose function. For CONTOUR mapping, it only checks for inclusion (returns 1 or -1). For more direct index retrieval, see <span class="tt">get_mask_idx</span>. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>The transport grid index to check. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>For CONTOUR, returns 1 if inside, -1 if outside. For other methods, returns the mapped ROI index or -1 if outside. </dd></dl>

<p class="definition">Definition at line <a class="el" href="mqi__roi_8hpp_source.html#l00092">92</a> of file <a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classmqi_1_1roi__t_affd7f29cf86969787c38a73c1f48c557_cgraph.png" border="0" usemap="#aclassmqi_1_1roi__t_affd7f29cf86969787c38a73c1f48c557_cgraph" loading="lazy" alt=""/></div>
</div>

</div>
</div>
<a id="a1ec54fc184d0bffe3cb232f6c25e7598" name="a1ec54fc184d0bffe3cb232f6c25e7598"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ec54fc184d0bffe3cb232f6c25e7598">&#9670;&#160;</a></span>idx_contour()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a> int32_t mqi::roi_t::idx_contour </td>
          <td>(</td>
          <td class="paramtype">const uint32_t &amp;</td>          <td class="paramname"><span class="paramname"><em>v</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Checks if a transport index is within any contour segment. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>The transport grid index. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if <span class="tt">v</span> is inside a contour segment, otherwise -1. </dd></dl>
<p>is in stride</p>

<p class="definition">Definition at line <a class="el" href="mqi__roi_8hpp_source.html#l00192">192</a> of file <a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classmqi_1_1roi__t_a1ec54fc184d0bffe3cb232f6c25e7598_cgraph.png" border="0" usemap="#aclassmqi_1_1roi__t_a1ec54fc184d0bffe3cb232f6c25e7598_cgraph" loading="lazy" alt=""/></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classmqi_1_1roi__t_a1ec54fc184d0bffe3cb232f6c25e7598_icgraph.png" border="0" usemap="#aclassmqi_1_1roi__t_a1ec54fc184d0bffe3cb232f6c25e7598_icgraph" loading="lazy" alt=""/></div>
</div>

</div>
</div>
<a id="a032dd49ae2788d2abcbd6d8969db742f" name="a032dd49ae2788d2abcbd6d8969db742f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a032dd49ae2788d2abcbd6d8969db742f">&#9670;&#160;</a></span>idx_indirect()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a> int32_t mqi::roi_t::idx_indirect </td>
          <td>(</td>
          <td class="paramtype">const uint32_t &amp;</td>          <td class="paramname"><span class="paramname"><em>v</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the mapped index for the INDIRECT method. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>The transport grid index. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The mapped ROI index from the lookup table. </dd></dl>

<p class="definition">Definition at line <a class="el" href="mqi__roi_8hpp_source.html#l00209">209</a> of file <a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>.</p>

</div>
</div>
<a id="a2aeb34103c1b74ae019ea7215991c81b" name="a2aeb34103c1b74ae019ea7215991c81b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2aeb34103c1b74ae019ea7215991c81b">&#9670;&#160;</a></span>lower_bound_cpp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="mqi__common_8hpp.html#ae1a4fe884f889ba6d532db4c1d191eb7">CUDA_HOST_DEVICE</a> int32_t mqi::roi_t::lower_bound_cpp </td>
          <td>(</td>
          <td class="paramtype">const int32_t &amp;</td>          <td class="paramname"><span class="paramname"><em>value</em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A custom binary search implementation to find the lower bound of a value in the <span class="tt">start_</span> array. </p>
<p>This is a key performance component for the CONTOUR method, as it efficiently finds the run-length-encoded segment that might contain the transport index <span class="tt">v</span>. <span class="tt">std::lower_bound</span> is part of the C++ standard library, but it may not be available or may have performance implications when compiling for a GPU (<span class="tt">__CUDA_ARCH__</span>). This custom implementation ensures the code works correctly and efficiently on both CPU and GPU. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">value</td><td>The transport index to search for. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The index of the first element in <span class="tt">start_</span> that is greater than <span class="tt">value</span>. </dd></dl>

<p class="definition">Definition at line <a class="el" href="mqi__roi_8hpp_source.html#l00226">226</a> of file <a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classmqi_1_1roi__t_a2aeb34103c1b74ae019ea7215991c81b_icgraph.png" border="0" usemap="#aclassmqi_1_1roi__t_a2aeb34103c1b74ae019ea7215991c81b_icgraph" loading="lazy" alt=""/></div>
</div>

</div>
</div>
<a name="doc-variable-members" id="doc-variable-members"></a><h2 id="header-doc-variable-members" class="groupheader">Member Data Documentation</h2>
<a id="aac34fc25faebb20a51b513ba327d5861" name="aac34fc25faebb20a51b513ba327d5861"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac34fc25faebb20a51b513ba327d5861">&#9670;&#160;</a></span>acc_stride_</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t* mqi::roi_t::acc_stride_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>For CONTOUR only: The accumulated length of all preceding runs. <span class="tt">acc_stride_[i]</span> gives the starting index in the ROI array for the i-th run. </p>

<p class="definition">Definition at line <a class="el" href="mqi__roi_8hpp_source.html#l00059">59</a> of file <a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>.</p>

</div>
</div>
<a id="ac717667bcbeb499c5ad5c51a8280e775" name="ac717667bcbeb499c5ad5c51a8280e775"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac717667bcbeb499c5ad5c51a8280e775">&#9670;&#160;</a></span>length_</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t mqi::roi_t::length_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The number of elements in the mapping arrays (<span class="tt">start_</span>, <span class="tt">stride_</span>, <span class="tt">acc_stride_</span>). For INDIRECT, this is the size of the lookup table. For CONTOUR, it's the number of "runs". </p>

<p class="definition">Definition at line <a class="el" href="mqi__roi_8hpp_source.html#l00054">54</a> of file <a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>.</p>

</div>
</div>
<a id="a27f1ec8039fb8db4c54e79da6032b48b" name="a27f1ec8039fb8db4c54e79da6032b48b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27f1ec8039fb8db4c54e79da6032b48b">&#9670;&#160;</a></span>method_</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacemqi.html#a8e583bf8677c9d3aaecfdced26932148">roi_mapping_t</a> mqi::roi_t::method_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The mapping method to use (DIRECT, INDIRECT, or CONTOUR). </p>

<p class="definition">Definition at line <a class="el" href="mqi__roi_8hpp_source.html#l00052">52</a> of file <a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>.</p>

</div>
</div>
<a id="a267ca456284546f73fb9fcd00a7d874d" name="a267ca456284546f73fb9fcd00a7d874d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a267ca456284546f73fb9fcd00a7d874d">&#9670;&#160;</a></span>original_length_</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t mqi::roi_t::original_length_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The total number of voxels in the original, full transport grid (e.g., 512*512*200). </p>

<p class="definition">Definition at line <a class="el" href="mqi__roi_8hpp_source.html#l00053">53</a> of file <a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>.</p>

</div>
</div>
<a id="a85f363d41670774f21b5c341950ce0ed" name="a85f363d41670774f21b5c341950ce0ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85f363d41670774f21b5c341950ce0ed">&#9670;&#160;</a></span>start_</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t* mqi::roi_t::start_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>For INDIRECT: A lookup table where <span class="tt">start_[transport_idx] = roi_idx</span>. For CONTOUR: The transport index where each run of ROI voxels begins. </p>

<p class="definition">Definition at line <a class="el" href="mqi__roi_8hpp_source.html#l00057">57</a> of file <a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>.</p>

</div>
</div>
<a id="ac29a348e0e4fe7db0561290e638031a0" name="ac29a348e0e4fe7db0561290e638031a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac29a348e0e4fe7db0561290e638031a0">&#9670;&#160;</a></span>stride_</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t* mqi::roi_t::stride_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>For CONTOUR only: The length (number of consecutive voxels) of each run. </p>

<p class="definition">Definition at line <a class="el" href="mqi__roi_8hpp_source.html#l00058">58</a> of file <a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>base/<a class="el" href="mqi__roi_8hpp_source.html">mqi_roi.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="namespacemqi.html">mqi</a></li><li class="navelem"><a href="classmqi_1_1roi__t.html">roi_t</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
